<section class="energo-menu">
  <div class="container">
    <div class="em-card" aria-labelledby="menu-title">
      <div class="em-head">
        <div class="em-title">
          <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3 4h2v16H3zM9 4h2v7a2 2 0 0 1-2 2v7H7v-7a2 2 0 0 1-2-2V4h2v6h2V4zm6 0h2v7h3v2h-3v7h-2V4z" fill="currentColor"/>
          </svg>
          <h2 id="menu-title">Jedálny lístok</h2>
          <span class="em-chip">auto-update</span>
        </div>
        <time class="em-updated" id="menuUpdated" datetime="">Aktualizované — …</time>
      </div>

      <figure class="em-figure" id="menuFigure">
        <img id="menuImg" class="em-img" alt="Jedálny lístok" loading="lazy" decoding="async">
      </figure>

      <div class="em-actions">
        <button class="btn em-zoom" id="zoomBtn" type="button">Zväčšiť</button>
        <a class="btn ghost" id="openFull" href="/assets/menu.jpg" target="_blank" rel="noopener">Otvoriť v plnom</a>
      </div>
    </div>
  </div>
</section>

<!-- Lightbox -->
<div class="em-lightbox" id="menuLightbox" role="dialog" aria-modal="true" aria-label="Zväčšený jedálny lístok">
  <div class="em-lightbox__inner">
    <button class="em-lightbox__close" id="lbClose" type="button">✕</button>
    <img class="em-lightbox__img" id="lbImg" alt="">
  </div>
</div>

<style>
  /* ===== Energo menu – štýl doladený k tvojmu CSS ===== */
  .energo-menu{ position:relative; padding:26px 0 56px; }
  /* jemný akcentový glow na pozadí sekcie, ako v hero */
  .energo-menu::before{
    content:""; position:absolute; inset:0; pointer-events:none; z-index:0;
    background:
      radial-gradient(900px 320px at 12% -10%, color-mix(in oklab, var(--accent) 22%, transparent), transparent 65%),
      radial-gradient(700px 260px at 88% 110%, color-mix(in oklab, var(--accent) 14%, transparent), transparent 65%);
    opacity:.7;
  }

  .energo-menu .em-card{
    position:relative; z-index:1;
    background:linear-gradient(180deg,#111113,#0f0f11);
    border:1px solid var(--border);
    border-radius:var(--radius);
    padding:20px;
    box-shadow:var(--shadow);
    backdrop-filter:saturate(1.2) blur(6px);
  }
  /* tenká akcentová línia hore – rovnaký „podpis“ ako na kartách */
  .energo-menu .em-card::before{
    content:""; position:absolute; left:-1px; right:-1px; top:-1px; height:3px; opacity:.9;
    border-top-left-radius:calc(var(--radius) + 2px);
    border-top-right-radius:calc(var(--radius) + 2px);
    background:linear-gradient(90deg,transparent,var(--accent) 20%,var(--accent) 80%,transparent);
  }

  .energo-menu .em-head{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:12px; }
  .energo-menu .em-title{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px; }
  .energo-menu .em-chip{
    padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700;
    border:1px solid color-mix(in oklab, var(--accent) 60%, transparent);
    background:linear-gradient(180deg,#131315,#101013); color:#e9e9ea;
  }
  .energo-menu .em-updated{ color:var(--muted); font-size:14px; }

  .energo-menu .em-figure{
    position:relative; overflow:hidden; border-radius:calc(var(--radius) - 6px);
    background:linear-gradient(180deg,rgba(255,255,255,.03),transparent 120%);
    display:grid; place-items:center;
  }
  /* skeleton shimmer – vizuálne zapadá do dark UI */
  .energo-menu .em-figure::after{
    content:""; position:absolute; inset:0;
    background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);
    transform:translateX(-100%); animation:emShimmer 1.1s infinite;
  }
  .energo-menu .em-figure.loaded::after{ display:none; }
  @keyframes emShimmer{ to{ transform:translateX(100%); } }

  .energo-menu .em-img{
    width:100%; height:auto; display:block; cursor:zoom-in;
    transition:transform .22s ease;
    box-shadow:0 8px 20px rgba(0,0,0,.25);
  }
  .energo-menu .em-img:hover{ transform:scale(1.007); }

  .energo-menu .em-actions{ display:flex; justify-content:flex-end; gap:10px; margin-top:12px; }
  .energo-menu .em-zoom{ border:1px solid var(--accent); background:linear-gradient(180deg,var(--accent),var(--accent-700)); color:#fff; }
  .energo-menu .btn{ display:inline-flex; align-items:center; gap:10px; padding:9px 12px; border-radius:10px; font-weight:800; letter-spacing:.2px; }
  .energo-menu .ghost{ border:1px solid #2b2b2f; background:linear-gradient(180deg,#131315,#101013); color:var(--text); }
  .energo-menu .ghost:hover{ border-color:var(--accent); }

  /* Lightbox (zoom) v Energo štýle */
  .em-lightbox{ position:fixed; inset:0; display:none; place-items:center; z-index:9999;
    background:rgba(0,0,0,.7); backdrop-filter:blur(2px); }
  .em-lightbox.open{ display:grid; }
  .em-lightbox__inner{ position:relative; width:min(95vw,1100px); max-height:92vh; }
  .em-lightbox__img{
    width:100%; height:auto; max-height:92vh; display:block; border-radius:14px;
    box-shadow:0 18px 48px rgba(0,0,0,.55);
    animation:emIn .16s ease-out;
  }
  @keyframes emIn{ from{ transform:scale(.96); opacity:.6; } to{ transform:scale(1); opacity:1; } }
  .em-lightbox__close{
    position:absolute; top:8px; right:8px; border:none; cursor:pointer;
    border-radius:10px; padding:6px 10px; background:rgba(0,0,0,.45); color:#fff;
  }
  .em-lightbox__close:focus-visible{ outline:2px solid var(--accent); outline-offset:2px; }

  /* Mobilné úpravy – sedí k tvojim breakpointom */
  @media (max-width:640px){
    .energo-menu .em-card{ padding:16px; }
    .energo-menu .em-updated{ font-size:13px; }
    .energo-menu .em-actions{ justify-content:center; }
  }
</style>

<script>
(function(){
  const today = new Date().toISOString().slice(0,10);
  const img = document.getElementById('menuImg');
  const fig = document.getElementById('menuFigure');
  const updatedEl = document.getElementById('menuUpdated');
  const fullLink = document.getElementById('openFull');
  const zoomBtn = document.getElementById('zoomBtn');

  // načítanie obrázka + skeleton
  img.src = '/assets/menu.jpg?v=' + today;
  function loaded(){ fig.classList.add('loaded'); }
  if (img.complete) loaded(); else img.addEventListener('load', loaded);
  img.addEventListener('error', ()=>{ fig.classList.add('loaded'); img.alt='Nepodarilo sa načítať jedálny lístok.'; });

  // meta z JSON (produkcia workflowu)
  fetch('/assets/menu.jpg.json', { cache: 'no-store' })
    .then(r=>r.ok?r.json():null)
    .then(d=>{
      const dt = new Date((d && d.fetchedAt) || Date.now());
      updatedEl.dateTime = dt.toISOString();
      updatedEl.textContent = 'Aktualizované — ' + dt.toLocaleString('sk-SK',{dateStyle:'medium',timeStyle:'short'});
      const full = (d && d.img) || '/assets/menu.jpg';
      fullLink.href = full + '?v=' + today;
      img.dataset.full = full + '?v=' + today;
    })
    .catch(()=>{ img.dataset.full = '/assets/menu.jpg?v=' + today; });

  // Lightbox
  const lb = document.getElementById('menuLightbox');
  const lbImg = document.getElementById('lbImg');
  const lbClose = document.getElementById('lbClose');
  function openLB(){ lbImg.src = img.dataset.full || img.src; lb.classList.add('open'); lbClose.focus(); }
  function closeLB(){ lb.classList.remove('open'); lbImg.src = ''; }
  img.addEventListener('click', openLB);
  zoomBtn.addEventListener('click', openLB);
  lb.addEventListener('click', (e)=>{ if (e.target === lb) closeLB(); });
  lbClose.addEventListener('click', closeLB);
  document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && lb.classList.contains('open')) closeLB(); });
})();
</script>
