<!-- ===== Energo: Jedálny lístok (responsive + lightbox) ===== -->
<style>
  .energo-menu{
    --accent:#ef4444; --surface:rgba(255,255,255,.04); --border:rgba(255,255,255,.10);
    --muted:#a4acb9; --radius:16px; --shadow:0 12px 34px rgba(0,0,0,.35);
  }
  @media (prefers-color-scheme:light){
    .energo-menu{ --surface:rgba(255,255,255,.72); --border:rgba(0,0,0,.08); --muted:#6b7280; }
  }
  .energo-menu .card{
    width:min(1000px,92vw); margin:clamp(16px,4vw,40px) auto; padding:18px 18px 22px;
    border-radius:var(--radius); background:linear-gradient(180deg,rgba(255,255,255,.02),transparent 120%),var(--surface);
    border:1px solid var(--border); backdrop-filter:blur(6px) saturate(120%); box-shadow:var(--shadow); position:relative;
  }
  .energo-menu .card::before{
    content:""; position:absolute; left:-1px; right:-1px; top:-1px; height:3px; opacity:.9;
    border-top-left-radius:calc(var(--radius)+2px); border-top-right-radius:calc(var(--radius)+2px);
    background:linear-gradient(90deg,transparent,var(--accent) 20%,var(--accent) 80%,transparent);
  }
  .energo-menu .head{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
  .energo-menu .title{ display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.2px; }
  .energo-menu .chip{ padding:2px 8px; border-radius:999px; font-size:.78rem;
    border:1px solid color-mix(in oklab, var(--accent) 60%, transparent); color:var(--accent); }
  .energo-menu .updated{ color:var(--muted); font-size:.9rem; }

  .energo-menu .figure{ position:relative; overflow:hidden; border-radius:calc(var(--radius) - 6px);
    background:linear-gradient(180deg,rgba(255,255,255,.04),transparent 120%); display:grid; place-items:center; }
  .energo-menu .figure::after{ content:""; position:absolute; inset:0;
    background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);
    transform:translateX(-100%); animation:shimmer 1.1s infinite; }
  .energo-menu .figure.loaded::after{ display:none; }
  @keyframes shimmer{ to{ transform:translateX(100%); } }

  .energo-menu .img{ width:100%; height:auto; display:block; cursor:zoom-in; transition:transform .22s ease; }
  .energo-menu .img:hover{ transform:scale(1.007); }

  .energo-menu .actions{ display:flex; justify-content:flex-end; gap:10px; margin-top:12px; }
  .energo-menu .btn{ padding:9px 12px; border-radius:12px; border:1px solid var(--border); background:transparent; color:inherit; text-decoration:none; }
  .energo-menu .btn-accent{ border-color:color-mix(in oklab, var(--accent) 60%, transparent); color:var(--accent); }

  /* Lightbox */
  .menu-lightbox{ position:fixed; inset:0; display:none; place-items:center; z-index:9999;
    background:rgba(0,0,0,.76); backdrop-filter:blur(2px); }
  .menu-lightbox.open{ display:grid; }
  .menu-lightbox__inner{ position:relative; width:min(95vw,1100px); max-height:92vh; }
  .menu-lightbox__img{ width:100%; height:auto; max-height:92vh; display:block; border-radius:14px;
    box-shadow:0 18px 48px rgba(0,0,0,.55); animation:lbIn .16s ease-out; }
  @keyframes lbIn{ from{ transform:scale(.96); opacity:.6; } to{ transform:scale(1); opacity:1; } }
  .menu-lightbox__close{ position:absolute; top:8px; right:8px; border:none; cursor:pointer;
    border-radius:10px; padding:6px 10px; background:rgba(0,0,0,.45); color:#fff; }
  .menu-lightbox__close:focus-visible{ outline:2px solid var(--accent); outline-offset:2px; }

  /* Mobile tweaks */
  @media (max-width:640px){
    .energo-menu .card{ padding:14px; width:min(100%,94vw); }
    .energo-menu .updated{ font-size:.82rem; }
    .energo-menu .title h2{ font-size:1.05rem; }
    .energo-menu .actions{ justify-content:center; }
  }
</style>

<section class="energo-menu">
  <div class="card" aria-labelledby="menu-title">
    <div class="head">
      <div class="title">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 4h2v16H3zM9 4h2v7a2 2 0 0 1-2 2v7H7v-7a2 2 0 0 1-2-2V4h2v6h2V4zm6 0h2v7h3v2h-3v7h-2V4z" fill="currentColor"/>
        </svg>
        <h2 id="menu-title">Jedálny lístok</h2>
        <span class="chip">auto-update</span>
      </div>
      <time class="updated" id="menuUpdated" datetime="">Aktualizované — …</time>
    </div>

    <figure class="figure" id="menuFigure">
      <img id="menuImg" class="img" alt="Jedálny lístok" loading="lazy" decoding="async">
    </figure>

    <div class="actions">
      <button class="btn btn-accent" id="zoomBtn" type="button">Zväčšiť</button>
      <a class="btn" id="openFull" href="/assets/menu.jpg" target="_blank" rel="noopener">Otvoriť v plnom</a>
    </div>
  </div>
</section>

<!-- Lightbox -->
<div class="menu-lightbox" id="menuLightbox" aria-modal="true" role="dialog" aria-label="Zväčšený jedálny lístok">
  <div class="menu-lightbox__inner">
    <button class="menu-lightbox__close" id="lbClose" type="button">✕</button>
    <img class="menu-lightbox__img" id="lbImg" alt="">
  </div>
</div>

<script>
(function(){
  const today = new Date().toISOString().slice(0,10);
  const img = document.getElementById('menuImg');
  const fig = document.getElementById('menuFigure');
  const updatedEl = document.getElementById('menuUpdated');
  const fullLink = document.getElementById('openFull');
  const zoomBtn = document.getElementById('zoomBtn');

  // načítanie obrázka + skeleton
  img.src = '/assets/menu.jpg?v=' + today;
  function loaded(){ fig.classList.add('loaded'); }
  if (img.complete) loaded(); else img.addEventListener('load', loaded);
  img.addEventListener('error', ()=>{ fig.classList.add('loaded'); img.alt='Nepodarilo sa načítať jedálny lístok.'; });

  // info z JSON (z workflowu)
  fetch('/assets/menu.jpg.json', { cache: 'no-store' })
    .then(r=>r.ok?r.json():null)
    .then(d=>{
      const dt = new Date((d && d.fetchedAt) || Date.now());
      updatedEl.dateTime = dt.toISOString();
      updatedEl.textContent = 'Aktualizované — ' + dt.toLocaleString('sk-SK',{dateStyle:'medium',timeStyle:'short'});
      const full = (d && d.img) || '/assets/menu.jpg';
      fullLink.href = full + '?v=' + today;
      // ulož „full“ URL pre lightbox
      img.dataset.full = full + '?v=' + today;
    })
    .catch(()=>{ img.dataset.full = '/assets/menu.jpg?v=' + today; });

  // Lightbox / zoom
  const lb = document.getElementById('menuLightbox');
  const lbImg = document.getElementById('lbImg');
  const lbClose = document.getElementById('lbClose');

  function openLB(){
    lbImg.src = img.dataset.full || img.src;
    lb.classList.add('open');
    lbClose.focus();
  }
  function closeLB(){
    lb.classList.remove('open');
    lbImg.src = '';
  }

  img.addEventListener('click', openLB);
  zoomBtn.addEventListener('click', openLB);
  lb.addEventListener('click', (e)=>{ if (e.target === lb) closeLB(); });
  lbClose.addEventListener('click', closeLB);
  document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && lb.classList.contains('open')) closeLB(); });
})();
</script>
